[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

# Pass these environment variables as build arguments
[build.buildArgs]
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY = "${{NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY}}"
CLERK_SECRET_KEY = "${{CLERK_SECRET_KEY}}"

[deploy]
startCommand = "npm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 5

# Health check configuration
healthcheckPath = "/api/health"
healthcheckTimeout = 100

# Resource limits to prevent crashes
[[deploy.resourceLimits]]
memory = 2048  # 2GB RAM
cpu = 2        # 2 vCPUs

# Environment variables
[deploy.env]
NODE_ENV = "production"
NEXT_TELEMETRY_DISABLED = "1"
COOKIES_UPLOAD_DIR = "./uploads"
